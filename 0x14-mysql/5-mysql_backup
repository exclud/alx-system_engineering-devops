#!/usr/bin/env bash

# Check if password is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <mysql-root-password>"
    exit 1
fi

# Set the password
PASSWORD=$1

# Create a MySQL dump
mysqldump -u root -p${PASSWORD} --all-databases > backup.sql

# Check if mysqldump had an error
if [ $? -ne 0 ]; then
    echo "mysqldump had an error, exiting..."
    exit 1
fi

# Get the current date in the format day-month-year
CURRENT_DATE=$(date +"%d-%m-%Y")

# Compress the dump to a tar.gz archive
tar -czf ${CURRENT_DATE}.tar.gz backup.sql

# Clean up the dump file after archiving
rm backup.sql

echo "Backup completed: ${CURRENT_DATE}.tar.gz"
